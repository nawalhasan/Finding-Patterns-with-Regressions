---
title: "DA2-HW1"
author: "Nawal Zehra Hasan"
date: "11/24/2021"
output:
  pdf_document: default
  html_document: default
---
Task: Model the differences in earning by age and education level.

To complete this task, I used cps-earnings data set to analyze the gap between earnings by gender in the Chief Executives occupation. I also modeled a relationship between gender and level of education received by individuals.
After this, I interpreted the results as per my model.

```{r}
#cleaning the environment
rm ( list = ls ( ) )
```

```{r setup, include=FALSE}
library(tidyverse)
library(modelsummary)
library(readr)
library(base)
library(cowplot)
library(boot)
library(estimatr)
library(huxtable)
library(stargazer)
library(modelsummary)
library(dplyr)
library(data.table)
library(knitr)
library(ggplot2)
```

After loading the data I filtered the data by;
-occupation: Chief Executives
-education level: Masters or above
-weekly working hours: 40 and above
-weekly earnings: anything greater than zero
-age: 35 and above

#1.Data Work
```{r data work}
#Loading the data-cps-earnings data set
df <- read_csv ( "https://osf.io/4ay9x/download" )

#check the first few rows of the data set
head ( df )

#no. of women in the data set
no_females <- count ( df [ which ( df$sex == 2 ) , ] ) #73738/149316 are women approx 49%

#selecting relevant observations
data <- df %>% filter ( occ2012 == 10, #code for chief executives
                    grade92 >= 43, #edu. level Masters or above
                    uhours >= 40, #working hours
                    earnwke >= 0, #weekly earnings
                    age >= 35 ) #35 or above years of age

#no. of women in the occupation                                
no_females <- count ( data [ which ( data$sex == 2 ) , ] ) # 211/874 females approx 24%

#Creating relevant variables to the data set
data <- data %>% mutate ( female=as.numeric(sex == 2 ) ) %>%
                 mutate ( h_wage = earnwke/uhours ) %>%
                 mutate ( lnw = log ( h_wage ) ) %>% 
                 mutate ( ed_BA=as.numeric(grade92==43),
                          ed_MA=as.numeric(grade92==44),
                          ed_Profess = as.numeric(grade92==45),
                          ed_PhD = as.numeric(grade92==46 ) )

#select relevant columns for analysis
#final_data <- data %>% select(X1, earnwke, uhours, grade92, sex, age, ind02, occ2012, h_wage, lnw, female, ed_BA, ed_MA, ed_Profess, ed_PhD)

```


#Unconditional gender gap
```{r}
P95 <- function( x ){ quantile( x,.95,na.rm=T ) }

datasummary( lnw ~ Mean + SD + Min + 
               Max + Median + P95 + N , data = data )


data %>% dplyr::select(earnwke,uhours,h_wage) %>% summary()
tabulate(data$female)
table(data$occ2012,data$female)


data <- data %>%  mutate ( sex = recode_factor ( sex,
                                `1` = "Male",
                                `2` = "Female" ) )
#summary statistics
datasummary(sex*lnw ~ 
               Mean + SD + Min + Max + N , data = data )

```

```{r unconditional}
#unconditonal gender gap by hourly wages
ggplot(data, aes(lnw, fill = sex)) + geom_histogram(alpha = 0.5, position = 'identity') +
  labs (x = "Log Hourly Wage", y = "Number of Respondents")

# plain SE
reg1<-lm(lnw ~ female , final_data) 
summary(reg1)

# with robust SE (Stata)
reg2 <- lm_robust(lnw ~ female, data = final_data, se_type = "HC1")
summary(reg2)

msummary(list(reg1, reg2),
         fmt="%.4f",
         gof_omit = 'DF|Deviance|Log.Lik.|F|R2 Adj.|AIC|BIC',
         stars=c('*' = .05, '**' = .01))

```

```{r education & gender} 

reg2 <- lm_robust(lnw ~ female + ed_BA + ed_MA + ed_Prof + ed_PhD, data=final_data, se_type = "HC1")

# add interaction between gender and education categories
reg3 <- lm_robust(lnw ~ female + ed_BA + ed_MA + ed_Prof + ed_PhD + female*ed_BA + female*ed_MA + female*ed_Profess + female*ed_PhD, data=final_data, se_type = "HC1")
```

```{r education & gender}
ggplot(data = final_data, aes(x = grade92, y = lnw , colour = sex )) + geom_point() + stat_smooth(method = 'loess', formula = y ~ x, size = 1) + theme(axis.text.x=element_text(angle = 0, vjust = 0.5)) + xlim(40,50) + 
  labs( x = "Highest Degree Completed", y = "Log of Hourly Wages")
```


```{r}

```


```{r education as factor }
final_data <- final_data %>% mutate ( grade92 = recode_factor(grade92,
                                             `43` = "ed_BA",
                                             `44` = "ed_MA",
                                             `45` = "ed_Profess",
                                             `46` = "ed_PhD")) 
```

```{r}
reg3 <- lm(lnw ~ sex + grade92, data = final_data)
summary(reg3)
```

```{r interactions}
ed_sex <- table(final_data$grade92)
reg4 <- update(reg3, . ~ . + grade92*sex)
summary(reg4)
```

```{r}

```

